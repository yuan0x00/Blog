import{_ as e,C as l,c as r,o,ai as n,j as i,a,G as h}from"./chunks/framework.BjpnAPRY.js";const y=JSON.parse('{"title":"Android é¢è¯•é«˜é¢‘è€ƒç‚¹ä¸å‚è€ƒç­”æ¡ˆ","description":"","frontmatter":{},"headers":[],"relativePath":"android/index.md","filePath":"android/index.md","lastUpdated":1760200632000}'),p={name:"android/index.md"};function d(k,s,c,g,E,u){const t=l("Mermaid");return o(),r("div",null,[s[4]||(s[4]=n(`<h1 id="android-é¢è¯•é«˜é¢‘è€ƒç‚¹ä¸å‚è€ƒç­”æ¡ˆ" tabindex="-1">Android é¢è¯•é«˜é¢‘è€ƒç‚¹ä¸å‚è€ƒç­”æ¡ˆ <a class="header-anchor" href="#android-é¢è¯•é«˜é¢‘è€ƒç‚¹ä¸å‚è€ƒç­”æ¡ˆ" aria-label="Permalink to &quot;Android é¢è¯•é«˜é¢‘è€ƒç‚¹ä¸å‚è€ƒç­”æ¡ˆ&quot;">â€‹</a></h1><h2 id="ä¸€ã€å››å¤§ç»„ä»¶ä¸ç”Ÿå‘½å‘¨æœŸ-å¿…è€ƒ" tabindex="-1">ä¸€ã€å››å¤§ç»„ä»¶ä¸ç”Ÿå‘½å‘¨æœŸï¼ˆå¿…è€ƒï¼‰ <a class="header-anchor" href="#ä¸€ã€å››å¤§ç»„ä»¶ä¸ç”Ÿå‘½å‘¨æœŸ-å¿…è€ƒ" aria-label="Permalink to &quot;ä¸€ã€å››å¤§ç»„ä»¶ä¸ç”Ÿå‘½å‘¨æœŸï¼ˆå¿…è€ƒï¼‰&quot;">â€‹</a></h2><h3 id="_1-activity-ç”Ÿå‘½å‘¨æœŸåŠä½¿ç”¨åœºæ™¯" tabindex="-1">1. <strong>Activity ç”Ÿå‘½å‘¨æœŸåŠä½¿ç”¨åœºæ™¯</strong> <a class="header-anchor" href="#_1-activity-ç”Ÿå‘½å‘¨æœŸåŠä½¿ç”¨åœºæ™¯" aria-label="Permalink to &quot;1. **Activity ç”Ÿå‘½å‘¨æœŸåŠä½¿ç”¨åœºæ™¯**&quot;">â€‹</a></h3><h4 id="âœ…-å‚è€ƒç­”æ¡ˆ" tabindex="-1">âœ… å‚è€ƒç­”æ¡ˆï¼š <a class="header-anchor" href="#âœ…-å‚è€ƒç­”æ¡ˆ" aria-label="Permalink to &quot;âœ… å‚è€ƒç­”æ¡ˆï¼š&quot;">â€‹</a></h4><ul><li><strong>æ ¸å¿ƒç”Ÿå‘½å‘¨æœŸæ–¹æ³•</strong>ï¼š<div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onCreate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() â†’ </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onStart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() â†’ </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onResume</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() â†’ [running] </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">â†’ </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onPause</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() â†’ </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onStop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() â†’ </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onDestroy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><strong>å…³é”®å›è°ƒè¯´æ˜</strong>ï¼š <ul><li><code>onCreate()</code>ï¼šåˆå§‹åŒ–å¸ƒå±€ã€ViewModelã€è®¢é˜…æ•°æ®ã€‚</li><li><code>onStart()</code>ï¼šUI å¯è§ä½†ä¸å¯äº¤äº’ï¼ˆæ¢å¤åŠ¨ç”»ã€ä¼ æ„Ÿå™¨ï¼‰ã€‚</li><li><code>onResume()</code>ï¼šå®Œå…¨å¯è§ä¸”å¯äº¤äº’ï¼ˆå¼€å§‹ç›¸æœºé¢„è§ˆã€ä½ç½®æ›´æ–°ï¼‰ã€‚</li><li><code>onPause()</code>ï¼š<strong>ä¿å­˜å…³é”®æ•°æ®</strong>ï¼ˆä¸èƒ½åšè€—æ—¶æ“ä½œï¼ï¼‰ï¼Œåœæ­¢åŠ¨ç”»ã€‚</li><li><code>onStop()</code>ï¼šUI ä¸å¯è§ï¼ˆé‡Šæ”¾èµ„æºå¦‚å¹¿æ’­ã€ä¼ æ„Ÿå™¨ï¼‰ã€‚</li><li><code>onDestroy()</code>ï¼šæœ€ç»ˆæ¸…ç†ï¼ˆä½†å¯èƒ½è¢«ç³»ç»Ÿç›´æ¥ killï¼Œä¸ä¿è¯è°ƒç”¨ï¼‰ã€‚</li></ul></li></ul><h4 id="å®é™…åº”ç”¨" tabindex="-1"><strong>å®é™…åº”ç”¨</strong>ï¼š <a class="header-anchor" href="#å®é™…åº”ç”¨" aria-label="Permalink to &quot;**å®é™…åº”ç”¨**ï¼š&quot;">â€‹</a></h4><ul><li><strong>ä¿å­˜çŠ¶æ€</strong>ï¼š<code>onSaveInstanceState()</code>ï¼ˆä¸´æ—¶çŠ¶æ€ï¼Œå¦‚æ—‹è½¬å±å¹•ï¼‰</li><li><strong>é¿å…å†…å­˜æ³„æ¼</strong>ï¼šåœ¨ <code>onPause()</code>/<code>onStop()</code> ä¸­æ³¨é”€ç›‘å¬å™¨ã€åœæ­¢çº¿ç¨‹ã€‚</li></ul><blockquote><p>ğŸ’¡ <strong>é¢è¯•åŠ åˆ†</strong>ï¼šæåˆ° <strong>Jetpack Lifecycle</strong> ç»„ä»¶å¯è‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥å‹ç»„ä»¶ã€‚</p></blockquote><hr><h3 id="_2-fragment-ä¸-activity-ç”Ÿå‘½å‘¨æœŸå…³ç³»" tabindex="-1">2. <strong>Fragment ä¸ Activity ç”Ÿå‘½å‘¨æœŸå…³ç³»</strong> <a class="header-anchor" href="#_2-fragment-ä¸-activity-ç”Ÿå‘½å‘¨æœŸå…³ç³»" aria-label="Permalink to &quot;2. **Fragment ä¸ Activity ç”Ÿå‘½å‘¨æœŸå…³ç³»**&quot;">â€‹</a></h3><h4 id="âœ…-å‚è€ƒç­”æ¡ˆ-1" tabindex="-1">âœ… å‚è€ƒç­”æ¡ˆï¼š <a class="header-anchor" href="#âœ…-å‚è€ƒç­”æ¡ˆ-1" aria-label="Permalink to &quot;âœ… å‚è€ƒç­”æ¡ˆï¼š&quot;">â€‹</a></h4><ul><li>Fragment ç”Ÿå‘½å‘¨æœŸ <strong>åµŒå¥—åœ¨ Activity ç”Ÿå‘½å‘¨æœŸå†…</strong>ã€‚</li><li><strong>å…³é”®é¡ºåº</strong>ï¼š <ul><li>Activity <code>onCreate()</code> â†’ Fragment <code>onAttach()</code> â†’ <code>onCreate()</code> â†’ <code>onCreateView()</code></li><li>Activity <code>onResume()</code> â†’ Fragment <code>onResume()</code></li><li><strong>è¿”å›æ ˆæ“ä½œ</strong>ï¼š<code>addToBackStack()</code> æ—¶ï¼ŒFragment ä¼šèµ° <code>onPause()</code> â†’ <code>onStop()</code>ï¼Œä½†ä¸ä¼š <code>onDestroyView()</code></li></ul></li></ul><h4 id="å¸¸è§é—®é¢˜" tabindex="-1"><strong>å¸¸è§é—®é¢˜</strong>ï¼š <a class="header-anchor" href="#å¸¸è§é—®é¢˜" aria-label="Permalink to &quot;**å¸¸è§é—®é¢˜**ï¼š&quot;">â€‹</a></h4><ul><li><strong>Fragment é‡å </strong>ï¼šæ—‹è½¬å±å¹•æ—¶æœªæ­£ç¡®å¤„ç† <code>savedInstanceState</code>ã€‚</li><li><strong>é€šä¿¡æ–¹å¼</strong>ï¼š <ul><li><strong>æ¨è</strong>ï¼šé€šè¿‡ <strong>ViewModel å…±äº«æ•°æ®</strong>ï¼ˆè§£è€¦ï¼‰</li><li>æ¬¡é€‰ï¼š<code>activity?.supportFragmentManager?.findFragmentByTag()</code></li></ul></li></ul><blockquote><p>âš ï¸ <strong>æ³¨æ„</strong>ï¼šé¿å…åœ¨ Fragment ä¸­ç›´æ¥æŒæœ‰ Activity å¼•ç”¨ï¼ˆå†…å­˜æ³„æ¼é£é™©ï¼‰ã€‚</p></blockquote><hr><h3 id="_3-service-ä¸-intentservice-åŒºåˆ«" tabindex="-1">3. <strong>Service ä¸ IntentService åŒºåˆ«</strong> <a class="header-anchor" href="#_3-service-ä¸-intentservice-åŒºåˆ«" aria-label="Permalink to &quot;3. **Service ä¸ IntentService åŒºåˆ«**&quot;">â€‹</a></h3><h4 id="âœ…-å‚è€ƒç­”æ¡ˆ-2" tabindex="-1">âœ… å‚è€ƒç­”æ¡ˆï¼š <a class="header-anchor" href="#âœ…-å‚è€ƒç­”æ¡ˆ-2" aria-label="Permalink to &quot;âœ… å‚è€ƒç­”æ¡ˆï¼š&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>ç‰¹æ€§</th><th>Service</th><th>IntentService</th></tr></thead><tbody><tr><td><strong>è¿è¡Œçº¿ç¨‹</strong></td><td>ä¸»çº¿ç¨‹ï¼ˆéœ€æ‰‹åŠ¨å¼€å­çº¿ç¨‹ï¼‰</td><td><strong>å·¥ä½œçº¿ç¨‹</strong>ï¼ˆHandlerThreadï¼‰</td></tr><tr><td><strong>ä»»åŠ¡é˜Ÿåˆ—</strong></td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… ä¸²è¡Œå¤„ç†å¤šä¸ª Intent</td></tr><tr><td><strong>è‡ªåŠ¨åœæ­¢</strong></td><td>âŒ éœ€æ‰‹åŠ¨ <code>stopSelf()</code></td><td>âœ… å¤„ç†å®Œè‡ªåŠ¨åœæ­¢</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>é•¿æœŸè¿è¡Œï¼ˆå¦‚éŸ³ä¹æ’­æ”¾ï¼‰</td><td>çŸ­æ—¶åå°ä»»åŠ¡ï¼ˆå¦‚ä¸Šä¼ æ—¥å¿—ï¼‰</td></tr></tbody></table><blockquote><p>ğŸš« <strong>ç°çŠ¶</strong>ï¼š<code>IntentService</code> å·²åºŸå¼ƒï¼ˆAndroid 8.0 ååå°é™åˆ¶ï¼‰ï¼Œ<strong>æ¨èä½¿ç”¨ WorkManager</strong>ã€‚</p></blockquote><hr><h3 id="_4-broadcastreceiver-ç±»å‹ä¸é™åˆ¶" tabindex="-1">4. <strong>BroadcastReceiver ç±»å‹ä¸é™åˆ¶</strong> <a class="header-anchor" href="#_4-broadcastreceiver-ç±»å‹ä¸é™åˆ¶" aria-label="Permalink to &quot;4. **BroadcastReceiver ç±»å‹ä¸é™åˆ¶**&quot;">â€‹</a></h3><h4 id="âœ…-å‚è€ƒç­”æ¡ˆ-3" tabindex="-1">âœ… å‚è€ƒç­”æ¡ˆï¼š <a class="header-anchor" href="#âœ…-å‚è€ƒç­”æ¡ˆ-3" aria-label="Permalink to &quot;âœ… å‚è€ƒç­”æ¡ˆï¼š&quot;">â€‹</a></h4><ul><li><strong>é™æ€æ³¨å†Œ</strong>ï¼ˆManifestï¼‰ï¼š <ul><li>å…¨å±€å¹¿æ’­ï¼ˆå¦‚å¼€æœºå¯åŠ¨ï¼‰</li><li><strong>Android 8.0+ é™åˆ¶</strong>ï¼šå¤§éƒ¨åˆ†éšå¼å¹¿æ’­æ— æ³•é™æ€æ³¨å†Œ</li></ul></li><li><strong>åŠ¨æ€æ³¨å†Œ</strong>ï¼ˆä»£ç ï¼‰ï¼š <ul><li>éœ€åœ¨ <code>onResume()</code> æ³¨å†Œï¼Œ<code>onPause()</code> æ³¨é”€ï¼ˆé¿å…å†…å­˜æ³„æ¼ï¼‰</li><li>å¯æ¥æ”¶æ˜¾å¼å¹¿æ’­å’Œéƒ¨åˆ†ç³»ç»Ÿå¹¿æ’­</li></ul></li></ul><h4 id="æ›¿ä»£æ–¹æ¡ˆ" tabindex="-1"><strong>æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼š <a class="header-anchor" href="#æ›¿ä»£æ–¹æ¡ˆ" aria-label="Permalink to &quot;**æ›¿ä»£æ–¹æ¡ˆ**ï¼š&quot;">â€‹</a></h4><ul><li><strong>å‰å°æœåŠ¡</strong>ï¼šéœ€æ˜¾ç¤ºé€šçŸ¥ï¼ˆAndroid 9+ï¼‰</li><li><strong>WorkManager</strong>ï¼šå»¶è¿Ÿ/å‘¨æœŸæ€§ä»»åŠ¡</li><li><strong>JobScheduler</strong>ï¼šç³»ç»Ÿçº§ä»»åŠ¡è°ƒåº¦</li></ul><blockquote><p>ğŸ’¡ <strong>å…³é”®ç‚¹</strong>ï¼šAndroid 8.0+ åå°æ‰§è¡Œé™åˆ¶ï¼ˆBackground Execution Limitsï¼‰æ˜¯é‡ç‚¹ï¼</p></blockquote><hr><h2 id="äºŒã€ui-ä½“ç³»ä¸è‡ªå®šä¹‰-view-é«˜é¢‘" tabindex="-1">äºŒã€UI ä½“ç³»ä¸è‡ªå®šä¹‰ Viewï¼ˆé«˜é¢‘ï¼‰ <a class="header-anchor" href="#äºŒã€ui-ä½“ç³»ä¸è‡ªå®šä¹‰-view-é«˜é¢‘" aria-label="Permalink to &quot;äºŒã€UI ä½“ç³»ä¸è‡ªå®šä¹‰ Viewï¼ˆé«˜é¢‘ï¼‰&quot;">â€‹</a></h2><h3 id="_5-view-ç»˜åˆ¶æµç¨‹-measure-â†’-layout-â†’-draw" tabindex="-1">5. <strong>View ç»˜åˆ¶æµç¨‹ï¼ˆMeasure â†’ Layout â†’ Drawï¼‰</strong> <a class="header-anchor" href="#_5-view-ç»˜åˆ¶æµç¨‹-measure-â†’-layout-â†’-draw" aria-label="Permalink to &quot;5. **View ç»˜åˆ¶æµç¨‹ï¼ˆMeasure â†’ Layout â†’ Drawï¼‰**&quot;">â€‹</a></h3><h4 id="âœ…-å‚è€ƒç­”æ¡ˆ-4" tabindex="-1">âœ… å‚è€ƒç­”æ¡ˆï¼š <a class="header-anchor" href="#âœ…-å‚è€ƒç­”æ¡ˆ-4" aria-label="Permalink to &quot;âœ… å‚è€ƒç­”æ¡ˆï¼š&quot;">â€‹</a></h4><ol><li><strong>Measure</strong>ï¼š <ul><li>çˆ¶ View è°ƒç”¨ <code>measure()</code> â†’ å­ View <code>onMeasure()</code></li><li>ä½¿ç”¨ <code>MeasureSpec</code>ï¼ˆæ¨¡å¼ + å¤§å°ï¼‰ç¡®å®šå°ºå¯¸</li><li>æ¨¡å¼ï¼š<code>EXACTLY</code>ï¼ˆç²¾ç¡®å€¼ï¼‰ã€<code>AT_MOST</code>ï¼ˆæœ€å¤§å€¼ï¼‰ã€<code>UNSPECIFIED</code>ï¼ˆæ— é™åˆ¶ï¼‰</li></ul></li><li><strong>Layout</strong>ï¼š <ul><li>çˆ¶ View è°ƒç”¨ <code>layout()</code> â†’ å­ View <code>onLayout()</code>ï¼ˆViewGroup éœ€å®ç°ï¼‰</li><li>ç¡®å®šå­ View ä½ç½®ï¼ˆleft, top, right, bottomï¼‰</li></ul></li><li><strong>Draw</strong>ï¼š <ul><li><code>onDraw()</code> ç»˜åˆ¶å†…å®¹ï¼ˆCanvas æ“ä½œï¼‰</li><li><strong>æ³¨æ„</strong>ï¼šView é»˜è®¤ä¸è°ƒç”¨ <code>onDraw()</code>ï¼Œéœ€ <code>setWillNotDraw(false)</code></li></ul></li></ol><h4 id="æ€§èƒ½ä¼˜åŒ–" tabindex="-1"><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼š <a class="header-anchor" href="#æ€§èƒ½ä¼˜åŒ–" aria-label="Permalink to &quot;**æ€§èƒ½ä¼˜åŒ–**ï¼š&quot;">â€‹</a></h4><ul><li>é¿å…åœ¨ <code>onDraw()</code> ä¸­åˆ›å»ºå¯¹è±¡ï¼ˆè§¦å‘ GCï¼‰</li><li>ä½¿ç”¨ <code>View.setLayerType()</code> å¼€å¯ç¡¬ä»¶åŠ é€Ÿï¼ˆæ…ç”¨ï¼Œå¯èƒ½æ›´æ…¢ï¼‰</li></ul><hr><h3 id="_6-äº‹ä»¶åˆ†å‘æœºåˆ¶-dispatchtouchevent-â†’-onintercepttouchevent-â†’-ontouchevent" tabindex="-1">6. <strong>äº‹ä»¶åˆ†å‘æœºåˆ¶ï¼ˆdispatchTouchEvent â†’ onInterceptTouchEvent â†’ onTouchEventï¼‰</strong> <a class="header-anchor" href="#_6-äº‹ä»¶åˆ†å‘æœºåˆ¶-dispatchtouchevent-â†’-onintercepttouchevent-â†’-ontouchevent" aria-label="Permalink to &quot;6. **äº‹ä»¶åˆ†å‘æœºåˆ¶ï¼ˆdispatchTouchEvent â†’ onInterceptTouchEvent â†’ onTouchEventï¼‰**&quot;">â€‹</a></h3><h4 id="âœ…-å‚è€ƒç­”æ¡ˆ-5" tabindex="-1">âœ… å‚è€ƒç­”æ¡ˆï¼š <a class="header-anchor" href="#âœ…-å‚è€ƒç­”æ¡ˆ-5" aria-label="Permalink to &quot;âœ… å‚è€ƒç­”æ¡ˆï¼š&quot;">â€‹</a></h4><ul><li><strong>æµç¨‹</strong>ï¼š <ol><li>Activity <code>dispatchTouchEvent()</code></li><li>ViewGroup <code>dispatchTouchEvent()</code> â†’ <strong><code>onInterceptTouchEvent()</code></strong>ï¼ˆæ˜¯å¦æ‹¦æˆªï¼‰</li><li>è‹¥ä¸æ‹¦æˆª â†’ å­ View <code>dispatchTouchEvent()</code> â†’ <code>onTouchEvent()</code></li><li>è‹¥å­ View ä¸æ¶ˆè´¹ â†’ å›ä¼ åˆ° ViewGroup <code>onTouchEvent()</code></li></ol></li><li><strong>å…³é”®æ–¹æ³•</strong>ï¼š <ul><li><code>onInterceptTouchEvent()</code>ï¼š<strong>ViewGroup ç‰¹æœ‰</strong>ï¼Œè¿”å› true è¡¨ç¤ºæ‹¦æˆª</li><li><code>onTouchEvent()</code>ï¼šè¿”å› true è¡¨ç¤ºæ¶ˆè´¹äº‹ä»¶</li></ul></li></ul><h4 id="ç»å…¸é—®é¢˜" tabindex="-1"><strong>ç»å…¸é—®é¢˜</strong>ï¼š <a class="header-anchor" href="#ç»å…¸é—®é¢˜" aria-label="Permalink to &quot;**ç»å…¸é—®é¢˜**ï¼š&quot;">â€‹</a></h4><ul><li><strong>æ»‘åŠ¨å†²çª</strong>ï¼šå¤–éƒ¨ ScrollView ä¸å†…éƒ¨ RecyclerView å†²çª <ul><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šé‡å†™ <code>onInterceptTouchEvent()</code>ï¼Œæ ¹æ®æ»‘åŠ¨æ–¹å‘å†³å®šæ˜¯å¦æ‹¦æˆª</li></ul></li></ul><blockquote><p>ğŸ’¡ <strong>å£è¯€</strong>ï¼š<strong>â€œé—®-æ‹¦-å¤„â€</strong>ï¼ˆdispatch â†’ intercept â†’ touchï¼‰</p></blockquote><hr><h3 id="_7-recyclerview-ä¼˜åŒ–ç­–ç•¥" tabindex="-1">7. <strong>RecyclerView ä¼˜åŒ–ç­–ç•¥</strong> <a class="header-anchor" href="#_7-recyclerview-ä¼˜åŒ–ç­–ç•¥" aria-label="Permalink to &quot;7. **RecyclerView ä¼˜åŒ–ç­–ç•¥**&quot;">â€‹</a></h3><h4 id="âœ…-å‚è€ƒç­”æ¡ˆ-6" tabindex="-1">âœ… å‚è€ƒç­”æ¡ˆï¼š <a class="header-anchor" href="#âœ…-å‚è€ƒç­”æ¡ˆ-6" aria-label="Permalink to &quot;âœ… å‚è€ƒç­”æ¡ˆï¼š&quot;">â€‹</a></h4><ul><li><strong>åŸºç¡€ä¼˜åŒ–</strong>ï¼š <ul><li>ä½¿ç”¨ <code>RecyclerView.ViewHolder</code></li><li><code>setHasFixedSize(true)</code>ï¼ˆItem é«˜åº¦å›ºå®šæ—¶ï¼‰</li><li>é¿å…åœ¨ <code>onBindViewHolder()</code> ä¸­åšè€—æ—¶æ“ä½œ</li></ul></li><li><strong>é«˜çº§ä¼˜åŒ–</strong>ï¼š <ul><li><strong>DiffUtil</strong>ï¼šè®¡ç®—æœ€å°å˜æ›´ï¼ˆé…åˆ <code>ListAdapter</code>ï¼‰</li><li><strong>é¢„åŠ è½½</strong>ï¼š<code>setItemViewCacheSize()</code>ã€<code>setRecycledViewPool()</code></li><li><strong>åµŒå¥—ä¼˜åŒ–</strong>ï¼šç¦æ­¢ RecyclerView åµŒå¥— ScrollViewï¼ˆç”¨ <code>NestedScrollView</code> + <code>setNestedScrollingEnabled(false)</code>ï¼‰</li></ul></li><li><strong>æ€§èƒ½ç›‘æ§</strong>ï¼š <ul><li>GPU æ¸²æŸ“åˆ†æï¼ˆå¼€å‘è€…é€‰é¡¹ â†’ Profile GPU Renderingï¼‰</li><li>StrictMode æ£€æµ‹ä¸»çº¿ç¨‹ IO</li></ul></li></ul><blockquote><p>ğŸ“Œ <strong>é¢è¯•äº®ç‚¹</strong>ï¼šæåˆ° <strong>â€œå±€éƒ¨åˆ·æ–°â€</strong>ï¼ˆ<code>notifyItemChanged(position, payload)</code>ï¼‰å¯å‡å°‘é‡ç»˜ã€‚</p></blockquote><hr><h2 id="ä¸‰ã€æ€§èƒ½ä¼˜åŒ–-å®æˆ˜é‡ç‚¹" tabindex="-1">ä¸‰ã€æ€§èƒ½ä¼˜åŒ–ï¼ˆå®æˆ˜é‡ç‚¹ï¼‰ <a class="header-anchor" href="#ä¸‰ã€æ€§èƒ½ä¼˜åŒ–-å®æˆ˜é‡ç‚¹" aria-label="Permalink to &quot;ä¸‰ã€æ€§èƒ½ä¼˜åŒ–ï¼ˆå®æˆ˜é‡ç‚¹ï¼‰&quot;">â€‹</a></h2><h3 id="_8-anr-application-not-responding-åŸå› ä¸æ’æŸ¥" tabindex="-1">8. <strong>ANRï¼ˆApplication Not Respondingï¼‰åŸå› ä¸æ’æŸ¥</strong> <a class="header-anchor" href="#_8-anr-application-not-responding-åŸå› ä¸æ’æŸ¥" aria-label="Permalink to &quot;8. **ANRï¼ˆApplication Not Respondingï¼‰åŸå› ä¸æ’æŸ¥**&quot;">â€‹</a></h3><h4 id="âœ…-å‚è€ƒç­”æ¡ˆ-7" tabindex="-1">âœ… å‚è€ƒç­”æ¡ˆï¼š <a class="header-anchor" href="#âœ…-å‚è€ƒç­”æ¡ˆ-7" aria-label="Permalink to &quot;âœ… å‚è€ƒç­”æ¡ˆï¼š&quot;">â€‹</a></h4><ul><li><strong>è§¦å‘æ¡ä»¶</strong>ï¼š <ul><li><strong>ä¸»çº¿ç¨‹é˜»å¡ &gt; 5ç§’</strong>ï¼ˆActivityï¼‰</li><li><strong>BroadcastReceiver &gt; 10ç§’</strong></li><li><strong>Service &gt; 20ç§’</strong></li></ul></li><li><strong>å¸¸è§åŸå› </strong>ï¼š <ul><li>ä¸»çº¿ç¨‹ I/Oï¼ˆè¯»å†™æ–‡ä»¶ã€æ•°æ®åº“ï¼‰</li><li>ä¸»çº¿ç¨‹å¤æ‚è®¡ç®—ï¼ˆæœªç”¨åç¨‹/çº¿ç¨‹æ± ï¼‰</li><li>æ­»é”ï¼ˆä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹ï¼Œå­çº¿ç¨‹ç­‰å¾…ä¸»çº¿ç¨‹ï¼‰</li></ul></li><li><strong>æ’æŸ¥å·¥å…·</strong>ï¼š <ul><li><strong>ANR æ—¥å¿—</strong>ï¼š<code>/data/anr/traces.txt</code></li><li><strong>Systrace</strong>ï¼šåˆ†æä¸»çº¿ç¨‹å¡é¡¿</li><li><strong>StrictMode</strong>ï¼šæ£€æµ‹ä¸»çº¿ç¨‹è¿è§„æ“ä½œ</li></ul></li></ul><h4 id="è§£å†³æ–¹æ¡ˆ" tabindex="-1"><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š <a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ" aria-label="Permalink to &quot;**è§£å†³æ–¹æ¡ˆ**ï¼š&quot;">â€‹</a></h4><ul><li>è€—æ—¶æ“ä½œç§»è‡³åå°çº¿ç¨‹ï¼ˆåç¨‹ã€ExecutorServiceï¼‰</li><li>æ•°æ®åº“æ“ä½œç”¨ Room + åç¨‹</li><li>é¿å…åœ¨ <code>onCreate()</code>/<code>onResume()</code> ä¸­åšåˆå§‹åŒ–</li></ul><hr><h3 id="_9-å†…å­˜æ³„æ¼å¸¸è§åœºæ™¯ä¸æ£€æµ‹" tabindex="-1">9. <strong>å†…å­˜æ³„æ¼å¸¸è§åœºæ™¯ä¸æ£€æµ‹</strong> <a class="header-anchor" href="#_9-å†…å­˜æ³„æ¼å¸¸è§åœºæ™¯ä¸æ£€æµ‹" aria-label="Permalink to &quot;9. **å†…å­˜æ³„æ¼å¸¸è§åœºæ™¯ä¸æ£€æµ‹**&quot;">â€‹</a></h3><h4 id="âœ…-å‚è€ƒç­”æ¡ˆ-8" tabindex="-1">âœ… å‚è€ƒç­”æ¡ˆï¼š <a class="header-anchor" href="#âœ…-å‚è€ƒç­”æ¡ˆ-8" aria-label="Permalink to &quot;âœ… å‚è€ƒç­”æ¡ˆï¼š&quot;">â€‹</a></h4><ul><li><p><strong>å¸¸è§æ³„æ¼ç‚¹</strong>ï¼š</p><table tabindex="0"><thead><tr><th>åœºæ™¯</th><th>åŸå› </th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>é™æ€ Context</strong></td><td><code>static Activity context</code></td><td>æ”¹ç”¨ <code>ApplicationContext</code></td></tr><tr><td><strong>Handler åŒ¿åå†…éƒ¨ç±»</strong></td><td>æŒæœ‰ Activity å¼•ç”¨</td><td>æ”¹ä¸ºé™æ€å†…éƒ¨ç±» + WeakReference</td></tr><tr><td><strong>æœªæ³¨é”€ç›‘å¬å™¨</strong></td><td>BroadcastReceiver/ä¼ æ„Ÿå™¨</td><td>åœ¨ <code>onPause()</code>/<code>onStop()</code> æ³¨é”€</td></tr><tr><td><strong>RxJava/åç¨‹æœªå–æ¶ˆ</strong></td><td>è®¢é˜…æœª dispose</td><td>ç”¨ <code>CompositeDisposable</code> æˆ– <code>viewModelScope</code></td></tr><tr><td><strong>View å¼•ç”¨æœªé‡Šæ”¾</strong></td><td>PopupWindow æŒæœ‰ Activity</td><td>è®¾ç½® <code>setFocusable(true)</code> æˆ–æ‰‹åŠ¨ detach</td></tr></tbody></table></li><li><p><strong>æ£€æµ‹å·¥å…·</strong>ï¼š</p><ul><li><strong>Android Profiler</strong>ï¼šå®æ—¶ç›‘æ§å†…å­˜</li><li><strong>LeakCanary</strong>ï¼šè‡ªåŠ¨æ£€æµ‹æ³„æ¼å¹¶ç”ŸæˆæŠ¥å‘Š</li></ul></li></ul><blockquote><p>ğŸ’¡ <strong>åŸåˆ™</strong>ï¼š<strong>ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶ï¼Œå¿…é¡»é‡Šæ”¾æ‰€æœ‰å¼ºå¼•ç”¨</strong>ã€‚</p></blockquote><hr><h3 id="_10-å¯åŠ¨ä¼˜åŒ–-å†·å¯åŠ¨-2s" tabindex="-1">10. <strong>å¯åŠ¨ä¼˜åŒ–ï¼ˆå†·å¯åŠ¨ &lt; 2sï¼‰</strong> <a class="header-anchor" href="#_10-å¯åŠ¨ä¼˜åŒ–-å†·å¯åŠ¨-2s" aria-label="Permalink to &quot;10. **å¯åŠ¨ä¼˜åŒ–ï¼ˆå†·å¯åŠ¨ &lt; 2sï¼‰**&quot;">â€‹</a></h3><h4 id="âœ…-å‚è€ƒç­”æ¡ˆ-9" tabindex="-1">âœ… å‚è€ƒç­”æ¡ˆï¼š <a class="header-anchor" href="#âœ…-å‚è€ƒç­”æ¡ˆ-9" aria-label="Permalink to &quot;âœ… å‚è€ƒç­”æ¡ˆï¼š&quot;">â€‹</a></h4><ul><li><strong>å¯åŠ¨é˜¶æ®µ</strong>ï¼š <ol><li><strong>Zygote fork è¿›ç¨‹</strong></li><li><strong>Application onCreate()</strong></li><li><strong>Activity onCreate() â†’ onResume()</strong></li></ol></li><li><strong>ä¼˜åŒ–ç­–ç•¥</strong>ï¼š <ul><li><strong>Application ä¼˜åŒ–</strong>ï¼š <ul><li>å»¶è¿Ÿåˆå§‹åŒ–éå¿…è¦ SDKï¼ˆå¦‚å‹ç›Ÿã€Buglyï¼‰</li><li>ä½¿ç”¨ <strong>ContentProvider è‡ªåŠ¨åˆå§‹åŒ–</strong>ï¼ˆè°¨æ…ï¼ï¼‰</li></ul></li><li><strong>Splash é¡µä¼˜åŒ–</strong>ï¼š <ul><li>è®¾ç½®ä¸»é¢˜èƒŒæ™¯ï¼ˆé¿å…ç™½å±ï¼‰ï¼š<div class="language-xml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">style</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SplashTheme&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> parent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Theme.AppCompat.Light.NoActionBar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">item</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;android:windowBackground&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;@drawable/splash_bg&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">style</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li>é¦–å±æ•°æ®é¢„åŠ è½½ï¼ˆåç¨‹ï¼‰</li></ul></li><li><strong>å·¥å…·åˆ†æ</strong>ï¼š <ul><li><code>adb shell am start -W [package]/[activity]</code> æŸ¥çœ‹å¯åŠ¨æ—¶é—´</li><li>Systrace åˆ†æä¸»çº¿ç¨‹è€—æ—¶</li></ul></li></ul></li></ul><blockquote><p>ğŸ“Œ <strong>ç›®æ ‡</strong>ï¼šå†·å¯åŠ¨ <strong>&lt; 2 ç§’</strong>ï¼ˆGoogle Play è¦æ±‚ï¼‰</p></blockquote><hr><h2 id="å››ã€æ¶æ„ä¸å·¥ç¨‹åŒ–-ä¸­é«˜çº§é‡ç‚¹" tabindex="-1">å››ã€æ¶æ„ä¸å·¥ç¨‹åŒ–ï¼ˆä¸­é«˜çº§é‡ç‚¹ï¼‰ <a class="header-anchor" href="#å››ã€æ¶æ„ä¸å·¥ç¨‹åŒ–-ä¸­é«˜çº§é‡ç‚¹" aria-label="Permalink to &quot;å››ã€æ¶æ„ä¸å·¥ç¨‹åŒ–ï¼ˆä¸­é«˜çº§é‡ç‚¹ï¼‰&quot;">â€‹</a></h2><h3 id="_11-mvvm-æ¶æ„ä¸-jetpack-ç»„ä»¶" tabindex="-1">11. <strong>MVVM æ¶æ„ä¸ Jetpack ç»„ä»¶</strong> <a class="header-anchor" href="#_11-mvvm-æ¶æ„ä¸-jetpack-ç»„ä»¶" aria-label="Permalink to &quot;11. **MVVM æ¶æ„ä¸ Jetpack ç»„ä»¶**&quot;">â€‹</a></h3><h4 id="âœ…-å‚è€ƒç­”æ¡ˆ-10" tabindex="-1">âœ… å‚è€ƒç­”æ¡ˆï¼š <a class="header-anchor" href="#âœ…-å‚è€ƒç­”æ¡ˆ-10" aria-label="Permalink to &quot;âœ… å‚è€ƒç­”æ¡ˆï¼š&quot;">â€‹</a></h4>`,67)),i("ul",null,[s[2]||(s[2]=n("<li><strong>æ ¸å¿ƒç»„ä»¶</strong>ï¼š <ul><li><strong>ViewModel</strong>ï¼šå­˜å‚¨ UI ç›¸å…³æ•°æ®ï¼Œ<strong>ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥</strong>ï¼ˆActivity é‡å»ºä¸ä¸¢å¤±ï¼‰</li><li><strong>LiveData</strong>ï¼šå¯è§‚å¯Ÿæ•°æ®æŒæœ‰è€…ï¼Œ<strong>è‡ªåŠ¨è§£æ³¨å†Œ</strong>ï¼ˆé¿å…å†…å­˜æ³„æ¼ï¼‰</li><li><strong>Room</strong>ï¼šSQLite æŠ½è±¡å±‚ï¼Œæ”¯æŒåç¨‹/Flow</li><li><strong>Navigation</strong>ï¼šå• Activity å¤š Fragment å¯¼èˆª</li></ul></li>",1)),i("li",null,[s[0]||(s[0]=i("strong",null,"æ•°æ®æµ",-1)),s[1]||(s[1]=a("ï¼š",-1)),h(t,{id:"mermaid-862",graph:"graph%20LR%0A%20%20Repository%20--%3E%20ViewModel%0A%20%20ViewModel%20--%3E%20LiveData%0A%20%20LiveData%20--%3E%20Activity%2FFragment%0A"})]),s[3]||(s[3]=i("li",null,[i("strong",null,"ä¼˜åŠ¿"),a("ï¼š "),i("ul",null,[i("li",null,[i("strong",null,"è§£è€¦"),a("ï¼šUI ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»")]),i("li",null,[i("strong",null,"ç”Ÿå‘½å‘¨æœŸå®‰å…¨"),a("ï¼šè‡ªåŠ¨ç®¡ç†è®¢é˜…")]),i("li",null,[i("strong",null,"æµ‹è¯•å‹å¥½"),a("ï¼šViewModel å¯å•å…ƒæµ‹è¯•")])])],-1))]),s[5]||(s[5]=n(`<blockquote><p>ğŸ’¡ <strong>è¿›é˜¶</strong>ï¼šç”¨ <strong>StateFlow</strong> æ›¿ä»£ LiveDataï¼ˆKotlin åç¨‹ç”Ÿæ€æ›´ä½³ï¼‰</p></blockquote><hr><h3 id="_12-åç¨‹åœ¨-android-ä¸­çš„æœ€ä½³å®è·µ" tabindex="-1">12. <strong>åç¨‹åœ¨ Android ä¸­çš„æœ€ä½³å®è·µ</strong> <a class="header-anchor" href="#_12-åç¨‹åœ¨-android-ä¸­çš„æœ€ä½³å®è·µ" aria-label="Permalink to &quot;12. **åç¨‹åœ¨ Android ä¸­çš„æœ€ä½³å®è·µ**&quot;">â€‹</a></h3><h4 id="âœ…-å‚è€ƒç­”æ¡ˆ-11" tabindex="-1">âœ… å‚è€ƒç­”æ¡ˆï¼š <a class="header-anchor" href="#âœ…-å‚è€ƒç­”æ¡ˆ-11" aria-label="Permalink to &quot;âœ… å‚è€ƒç­”æ¡ˆï¼š&quot;">â€‹</a></h4><ul><li><strong>ä½œç”¨åŸŸé€‰æ‹©</strong>ï¼š <ul><li><code>viewModelScope</code>ï¼šViewModel ä¸­ï¼ˆActivity é”€æ¯æ—¶è‡ªåŠ¨å–æ¶ˆï¼‰</li><li><code>lifecycleScope</code>ï¼šActivity/Fragment ä¸­ï¼ˆç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶å–æ¶ˆï¼‰</li></ul></li><li><strong>çº¿ç¨‹åˆ‡æ¢</strong>ï¼š <ul><li><strong>IO æ“ä½œ</strong>ï¼š<code>withContext(Dispatchers.IO)</code></li><li><strong>è®¡ç®—å¯†é›†</strong>ï¼š<code>withContext(Dispatchers.Default)</code></li><li><strong>UI æ›´æ–°</strong>ï¼šè‡ªåŠ¨åœ¨ä¸»çº¿ç¨‹ï¼ˆåç¨‹æ„å»ºå™¨é»˜è®¤ï¼‰</li></ul></li><li><strong>å¼‚å¸¸å¤„ç†</strong>ï¼š <ul><li><code>try-catch</code> åŒ…è£¹ suspend å‡½æ•°</li><li>å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼š<code>CoroutineExceptionHandler</code></li></ul></li></ul><h4 id="ç¤ºä¾‹" tabindex="-1"><strong>ç¤ºä¾‹</strong>ï¼š <a class="header-anchor" href="#ç¤ºä¾‹" aria-label="Permalink to &quot;**ç¤ºä¾‹**ï¼š&quot;">â€‹</a></h4><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ViewModel ä¸­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> loadUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    viewModelScope.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">launch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> repository.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åœ¨ IO çº¿ç¨‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            _uiState.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Success</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(user)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è‡ªåŠ¨åˆ‡å›ä¸»çº¿ç¨‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (e: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            _uiState.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p>ğŸš« <strong>é¿å…</strong>ï¼šåœ¨åç¨‹ä¸­ç›´æ¥è°ƒç”¨è€—æ—¶å‡½æ•°ï¼ˆæœªåˆ‡æ¢çº¿ç¨‹ï¼‰</p></blockquote><hr><h2 id="äº”ã€ç³»ç»ŸåŸç†ä¸åº•å±‚-é«˜çº§è€ƒç‚¹" tabindex="-1">äº”ã€ç³»ç»ŸåŸç†ä¸åº•å±‚ï¼ˆé«˜çº§è€ƒç‚¹ï¼‰ <a class="header-anchor" href="#äº”ã€ç³»ç»ŸåŸç†ä¸åº•å±‚-é«˜çº§è€ƒç‚¹" aria-label="Permalink to &quot;äº”ã€ç³»ç»ŸåŸç†ä¸åº•å±‚ï¼ˆé«˜çº§è€ƒç‚¹ï¼‰&quot;">â€‹</a></h2><h3 id="_13-handler-æ¶ˆæ¯æœºåˆ¶åŸç†" tabindex="-1">13. <strong>Handler æ¶ˆæ¯æœºåˆ¶åŸç†</strong> <a class="header-anchor" href="#_13-handler-æ¶ˆæ¯æœºåˆ¶åŸç†" aria-label="Permalink to &quot;13. **Handler æ¶ˆæ¯æœºåˆ¶åŸç†**&quot;">â€‹</a></h3><h4 id="âœ…-å‚è€ƒç­”æ¡ˆ-12" tabindex="-1">âœ… å‚è€ƒç­”æ¡ˆï¼š <a class="header-anchor" href="#âœ…-å‚è€ƒç­”æ¡ˆ-12" aria-label="Permalink to &quot;âœ… å‚è€ƒç­”æ¡ˆï¼š&quot;">â€‹</a></h4><ul><li><strong>æ ¸å¿ƒç»„ä»¶</strong>ï¼š <ul><li><strong>MessageQueue</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå•é“¾è¡¨å®ç°ï¼ŒæŒ‰æ—¶é—´æ’åºï¼‰</li><li><strong>Looper</strong>ï¼šå¾ªç¯ä» MQ å–æ¶ˆæ¯ï¼ˆ<code>loop()</code> æ­»å¾ªç¯ï¼‰</li><li><strong>Handler</strong>ï¼šå‘é€æ¶ˆæ¯ï¼ˆ<code>sendMessage()</code>ï¼‰å’Œå¤„ç†æ¶ˆæ¯ï¼ˆ<code>handleMessage()</code>ï¼‰</li></ul></li><li><strong>çº¿ç¨‹ç»‘å®š</strong>ï¼š <ul><li><strong>ä¸»çº¿ç¨‹ Looper</strong>ï¼šActivityThread åˆ›å»º</li><li><strong>å­çº¿ç¨‹ Looper</strong>ï¼šéœ€æ‰‹åŠ¨ <code>Looper.prepare()</code> + <code>Looper.loop()</code></li></ul></li><li><strong>å†…å­˜æ³„æ¼åŸå› </strong>ï¼š <ul><li>Handler åŒ¿åå†…éƒ¨ç±»æŒæœ‰ Activity å¼•ç”¨</li><li>Message æŒæœ‰ Handler å¼•ç”¨ â†’ é—´æ¥æŒæœ‰ Activity</li></ul></li></ul><h4 id="è§£å†³æ–¹æ¡ˆ-1" tabindex="-1"><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š <a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ-1" aria-label="Permalink to &quot;**è§£å†³æ–¹æ¡ˆ**ï¼š&quot;">â€‹</a></h4><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(activity: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Activity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Looper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMainLooper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weakRef </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WeakReference</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(activity)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    override</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        weakRef.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* å®‰å…¨ä½¿ç”¨ */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>ğŸ’¡ <strong>æ·±åº¦ç†è§£</strong>ï¼šMessage å¤ç”¨æ± ï¼ˆ<code>obtain()</code> / <code>recycle()</code>ï¼‰å‡å°‘ GC</p></blockquote><hr><h3 id="_14-binder-è·¨è¿›ç¨‹é€šä¿¡-ipc-åŸç†" tabindex="-1">14. <strong>Binder è·¨è¿›ç¨‹é€šä¿¡ï¼ˆIPCï¼‰åŸç†</strong> <a class="header-anchor" href="#_14-binder-è·¨è¿›ç¨‹é€šä¿¡-ipc-åŸç†" aria-label="Permalink to &quot;14. **Binder è·¨è¿›ç¨‹é€šä¿¡ï¼ˆIPCï¼‰åŸç†**&quot;">â€‹</a></h3><h4 id="âœ…-å‚è€ƒç­”æ¡ˆ-13" tabindex="-1">âœ… å‚è€ƒç­”æ¡ˆï¼š <a class="header-anchor" href="#âœ…-å‚è€ƒç­”æ¡ˆ-13" aria-label="Permalink to &quot;âœ… å‚è€ƒç­”æ¡ˆï¼š&quot;">â€‹</a></h4><ul><li><strong>ä¸ºä»€ä¹ˆç”¨ Binder</strong>ï¼Ÿ <ul><li>æ€§èƒ½ï¼š<strong>1 æ¬¡æ‹·è´</strong>ï¼ˆå…±äº«å†…å­˜éœ€ 2 æ¬¡ï¼ŒSocket æ›´å¤šï¼‰</li><li>å®‰å…¨ï¼šåŸºäº UID/PID éªŒè¯</li><li>æ˜“ç”¨ï¼šå°è£…ä¸º AIDL æ¥å£</li></ul></li><li><strong>é€šä¿¡æµç¨‹</strong>ï¼š <ol><li>Client è°ƒç”¨ AIDL æ¥å£ â†’ Proxy</li><li>Binder é©±åŠ¨ â†’ Server Manager</li><li>Server çš„ Stub å¤„ç†è¯·æ±‚ â†’ è¿”å›ç»“æœ</li></ol></li><li><strong>Android ä¸­çš„åº”ç”¨</strong>ï¼š <ul><li>ActivityManagerServiceï¼ˆAMSï¼‰</li><li>WindowManagerServiceï¼ˆWMSï¼‰</li><li>è‡ªå®šä¹‰ Serviceï¼ˆ<code>onBind()</code> è¿”å› IBinderï¼‰</li></ul></li></ul><blockquote><p>ğŸ“Œ <strong>é¢è¯•äº®ç‚¹</strong>ï¼šæåˆ° <strong>Binder çº¿ç¨‹æ± </strong>ï¼ˆæ¯ä¸ªè¿›ç¨‹é»˜è®¤ 15 ä¸ª Binder çº¿ç¨‹ï¼‰</p></blockquote><hr><h2 id="å…­ã€æ–°ç‰¹æ€§ä¸-jetpack-è¶‹åŠ¿è€ƒç‚¹" tabindex="-1">å…­ã€æ–°ç‰¹æ€§ä¸ Jetpackï¼ˆè¶‹åŠ¿è€ƒç‚¹ï¼‰ <a class="header-anchor" href="#å…­ã€æ–°ç‰¹æ€§ä¸-jetpack-è¶‹åŠ¿è€ƒç‚¹" aria-label="Permalink to &quot;å…­ã€æ–°ç‰¹æ€§ä¸ Jetpackï¼ˆè¶‹åŠ¿è€ƒç‚¹ï¼‰&quot;">â€‹</a></h2><h3 id="_15-compose-ä¸ä¼ ç»Ÿ-view-ç³»ç»Ÿå¯¹æ¯”" tabindex="-1">15. <strong>Compose ä¸ä¼ ç»Ÿ View ç³»ç»Ÿå¯¹æ¯”</strong> <a class="header-anchor" href="#_15-compose-ä¸ä¼ ç»Ÿ-view-ç³»ç»Ÿå¯¹æ¯”" aria-label="Permalink to &quot;15. **Compose ä¸ä¼ ç»Ÿ View ç³»ç»Ÿå¯¹æ¯”**&quot;">â€‹</a></h3><h4 id="âœ…-å‚è€ƒç­”æ¡ˆ-14" tabindex="-1">âœ… å‚è€ƒç­”æ¡ˆï¼š <a class="header-anchor" href="#âœ…-å‚è€ƒç­”æ¡ˆ-14" aria-label="Permalink to &quot;âœ… å‚è€ƒç­”æ¡ˆï¼š&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>ç‰¹æ€§</th><th>View ç³»ç»Ÿ</th><th>Jetpack Compose</th></tr></thead><tbody><tr><td><strong>å£°æ˜å¼</strong></td><td>âŒ å‘½ä»¤å¼ï¼ˆfindViewById + setï¼‰</td><td>âœ… å£°æ˜å¼ï¼ˆå‡½æ•°æè¿° UIï¼‰</td></tr><tr><td><strong>çŠ¶æ€é©±åŠ¨</strong></td><td>æ‰‹åŠ¨æ›´æ–°ï¼ˆsetTextï¼‰</td><td>è‡ªåŠ¨é‡ç»„ï¼ˆState é©±åŠ¨ï¼‰</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>éœ€æ‰‹åŠ¨ä¼˜åŒ–ï¼ˆViewHolderï¼‰</td><td>æ™ºèƒ½è·³è¿‡ï¼ˆRecompositionï¼‰</td></tr><tr><td><strong>å­¦ä¹ æ›²çº¿</strong></td><td>ä½</td><td>ä¸­ï¼ˆéœ€ç†è§£çŠ¶æ€ã€å‰¯ä½œç”¨ï¼‰</td></tr><tr><td><strong>äº’æ“ä½œ</strong></td><td>-</td><td>æ”¯æŒ <code>AndroidView</code> åµŒå…¥ä¼ ç»Ÿ View</td></tr></tbody></table><h4 id="compose-æ ¸å¿ƒæ¦‚å¿µ" tabindex="-1"><strong>Compose æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼š <a class="header-anchor" href="#compose-æ ¸å¿ƒæ¦‚å¿µ" aria-label="Permalink to &quot;**Compose æ ¸å¿ƒæ¦‚å¿µ**ï¼š&quot;">â€‹</a></h4><ul><li><strong>@Composable</strong>ï¼šå¯ç»„åˆå‡½æ•°</li><li><strong>State</strong>ï¼š<code>mutableStateOf()</code> é©±åŠ¨é‡ç»„</li><li><strong>Side Effect</strong>ï¼š<code>LaunchedEffect</code>ã€<code>DisposableEffect</code></li></ul><blockquote><p>ğŸ’¡ <strong>è¶‹åŠ¿</strong>ï¼šGoogle å…¨åŠ›æ¨è¿› Composeï¼Œ<strong>æ–°é¡¹ç›®é¦–é€‰ Compose</strong></p></blockquote><hr><h3 id="_16-hilt-ä¾èµ–æ³¨å…¥åŸç†" tabindex="-1">16. <strong>Hilt ä¾èµ–æ³¨å…¥åŸç†</strong> <a class="header-anchor" href="#_16-hilt-ä¾èµ–æ³¨å…¥åŸç†" aria-label="Permalink to &quot;16. **Hilt ä¾èµ–æ³¨å…¥åŸç†**&quot;">â€‹</a></h3><h4 id="âœ…-å‚è€ƒç­”æ¡ˆ-15" tabindex="-1">âœ… å‚è€ƒç­”æ¡ˆï¼š <a class="header-anchor" href="#âœ…-å‚è€ƒç­”æ¡ˆ-15" aria-label="Permalink to &quot;âœ… å‚è€ƒç­”æ¡ˆï¼š&quot;">â€‹</a></h4><ul><li><strong>ä½œç”¨</strong>ï¼šç®€åŒ– Dagger 2 ä½¿ç”¨ï¼Œ<strong>è‡ªåŠ¨ç”Ÿæˆä¾èµ–å›¾</strong></li><li><strong>æ ¸å¿ƒæ³¨è§£</strong>ï¼š <ul><li><code>@HiltAndroidApp</code>ï¼šApplication å…¥å£</li><li><code>@AndroidEntryPoint</code>ï¼šActivity/Fragment æ³¨å…¥ç‚¹</li><li><code>@Inject</code>ï¼šæ„é€ å‡½æ•°/å­—æ®µæ³¨å…¥</li></ul></li><li><strong>ä¼˜åŠ¿</strong>ï¼š <ul><li><strong>å‡å°‘æ¨¡æ¿ä»£ç </strong>ï¼ˆæ— éœ€ Component/Module æ‰‹å†™ï¼‰</li><li><strong>ä½œç”¨åŸŸç»‘å®š</strong>ï¼š<code>@Singleton</code>ã€<code>@ActivityScoped</code></li></ul></li><li><strong>åŸç†</strong>ï¼šç¼–è¯‘æœŸç”Ÿæˆ Dagger ä»£ç ï¼ˆAPTï¼‰</li></ul><h4 id="ç¤ºä¾‹-1" tabindex="-1"><strong>ç¤ºä¾‹</strong>ï¼š <a class="header-anchor" href="#ç¤ºä¾‹-1" aria-label="Permalink to &quot;**ç¤ºä¾‹**ï¼š&quot;">â€‹</a></h4><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@HiltAndroidApp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyApplication</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Application</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@AndroidEntryPoint</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MainActivity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AppCompatActivity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @Inject</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> lateinit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> repository: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UserRepository</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>ğŸ“Œ <strong>æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼šKoinï¼ˆè½»é‡çº§ï¼Œè¿è¡Œæ—¶åå°„ï¼‰</p></blockquote><hr><h2 id="ä¸ƒã€é«˜é¢‘æ‰‹å†™é¢˜" tabindex="-1">ä¸ƒã€é«˜é¢‘æ‰‹å†™é¢˜ <a class="header-anchor" href="#ä¸ƒã€é«˜é¢‘æ‰‹å†™é¢˜" aria-label="Permalink to &quot;ä¸ƒã€é«˜é¢‘æ‰‹å†™é¢˜&quot;">â€‹</a></h2><h3 id="_1-åŒé‡æ£€æŸ¥é”å®ç°å•ä¾‹" tabindex="-1">1. <strong>åŒé‡æ£€æŸ¥é”å®ç°å•ä¾‹</strong> <a class="header-anchor" href="#_1-åŒé‡æ£€æŸ¥é”å®ç°å•ä¾‹" aria-label="Permalink to &quot;1. **åŒé‡æ£€æŸ¥é”å®ç°å•ä¾‹**&quot;">â€‹</a></h3><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Singleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> volatile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Singleton instance;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Singleton </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            synchronized</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Singleton.class) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Singleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> instance;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><p>âš ï¸ <strong>å…³é”®</strong>ï¼š<code>volatile</code> ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼ˆé¿å…æœªåˆå§‹åŒ–å¯¹è±¡è¢«è®¿é—®ï¼‰</p></blockquote><hr><h3 id="_2-è‡ªå®šä¹‰-view-å®ç°åœ†å½¢å¤´åƒ" tabindex="-1">2. <strong>è‡ªå®šä¹‰ View å®ç°åœ†å½¢å¤´åƒ</strong> <a class="header-anchor" href="#_2-è‡ªå®šä¹‰-view-å®ç°åœ†å½¢å¤´åƒ" aria-label="Permalink to &quot;2. **è‡ªå®šä¹‰ View å®ç°åœ†å½¢å¤´åƒ**&quot;">â€‹</a></h3><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CircleImageView</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> @JvmOverloads</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    context: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    attrs: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AttributeSet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    defStyleAttr: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AppCompatImageView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">attrs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">defStyleAttr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> paint </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Paint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Paint.ANTI_ALIAS_FLAG).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        isFilterBitmap </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    override</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onDraw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(canvas: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Canvas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> radius </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (width.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">coerceAtMost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(height) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toFloat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        canvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawCircle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, radius, paint)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ç»˜åˆ¶å›¾ç‰‡ï¼ˆè£å‰ªä¸ºåœ†å½¢ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        drawable?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { drawable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            drawable.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setBounds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, width, height)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> shader </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BitmapShader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                getBitmapFromDrawable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(drawable),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                Shader.TileMode.CLAMP,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                Shader.TileMode.CLAMP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            paint.shader </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> shader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            canvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawCircle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, radius, paint)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><hr><h2 id="å…«ã€é¢è¯•å»ºè®®" tabindex="-1">å…«ã€é¢è¯•å»ºè®® <a class="header-anchor" href="#å…«ã€é¢è¯•å»ºè®®" aria-label="Permalink to &quot;å…«ã€é¢è¯•å»ºè®®&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th>èŒçº§</th><th>é‡ç‚¹æ–¹å‘</th></tr></thead><tbody><tr><td><strong>åˆçº§</strong></td><td>å››å¤§ç»„ä»¶ã€åŸºç¡€ UIã€ç®€å•ä¼˜åŒ–</td></tr><tr><td><strong>ä¸­çº§</strong></td><td>æ€§èƒ½ä¼˜åŒ–ã€æ¶æ„è®¾è®¡ã€åç¨‹/Flow</td></tr><tr><td><strong>é«˜çº§</strong></td><td>ç³»ç»ŸåŸç†ï¼ˆBinder/Handlerï¼‰ã€Composeã€è·¨ç«¯æ–¹æ¡ˆ</td></tr></tbody></table><h3 id="âœ…-å‡†å¤‡ç­–ç•¥" tabindex="-1">âœ… å‡†å¤‡ç­–ç•¥ï¼š <a class="header-anchor" href="#âœ…-å‡†å¤‡ç­–ç•¥" aria-label="Permalink to &quot;âœ… å‡†å¤‡ç­–ç•¥ï¼š&quot;">â€‹</a></h3><ol><li><strong>åŠ¨æ‰‹å®è·µ</strong>ï¼šç¡®ä¿èƒ½æ‰‹å†™ RecyclerView ä¼˜åŒ–ã€åç¨‹å°è£…ã€‚</li><li><strong>åŸç†æ·±æŒ–</strong>ï¼šç†è§£ Handlerã€Binderã€View ç»˜åˆ¶åº•å±‚æœºåˆ¶ã€‚</li><li><strong>é¡¹ç›®å¤ç›˜</strong>ï¼šå‡†å¤‡ 1-2 ä¸ªæ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹ï¼ˆå¦‚â€œANR ä» 5% é™åˆ° 0.1%â€ï¼‰ã€‚</li><li><strong>å…³æ³¨æ–°è¶‹åŠ¿</strong>ï¼šComposeã€Kotlin Multiplatformï¼ˆKMPï¼‰ã€Hiltã€‚</li></ol>`,49))])}const m=e(p,[["render",d]]);export{y as __pageData,m as default};
